import { createTutorial, createExample, createUser } from "@/lib/db";
import { runMigrations } from "@/lib/migrations";
import bcrypt from "bcryptjs";

const tutorialsData = [
  {
    slug: "getting-started",
    title: "–ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å Go",
    description:
      "–ò–∑—É—á–∏—Ç–µ –æ—Å–Ω–æ–≤—ã –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ Go, —É—Å—Ç–∞–Ω–æ–≤–∫—É –∏ –≤–∞—à—É –ø–µ—Ä–≤—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É.",
    level: "–ù–∞—á–∏–Ω–∞—é—â–∏–π",
    duration: "30 –º–∏–Ω",
    category: "basics",
    order: 1,
    is_free: true,
    content: `
# –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã —Å Go

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–∏—Ä –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ Go! –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –≤—ã –∏–∑—É—á–∏—Ç–µ –æ—Å–Ω–æ–≤—ã —è–∑—ã–∫–∞ Go –∏ —Å–æ–∑–¥–∞–¥–∏—Ç–µ —Å–≤–æ—é –ø–µ—Ä–≤—É—é –ø—Ä–æ–≥—Ä–∞–º–º—É.

## –ß—Ç–æ —Ç–∞–∫–æ–µ Go?

Go (—Ç–∞–∫–∂–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–π –∫–∞–∫ Golang) ‚Äî —ç—Ç–æ —è–∑—ã–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å –æ—Ç–∫—Ä—ã—Ç—ã–º –∏—Å—Ö–æ–¥–Ω—ã–º –∫–æ–¥–æ–º, —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –≤ Google. –û–Ω –±—ã–ª —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ä–µ—à–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ–≥–æ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –≤ Google: –º–Ω–æ–≥–æ—è–¥–µ—Ä–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—ã, —Å–µ—Ç–µ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã, –º–∞—Å—Å–∏–≤–Ω—ã–µ –∫–æ–¥–æ–≤—ã–µ –±–∞–∑—ã –∏ –≤–µ–±-—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞.

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ Go

- **–ü—Ä–æ—Å—Ç–æ—Ç–∞**: –ß–∏—Å—Ç—ã–π –∏ –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
- **–ë—ã—Å—Ç—Ä–æ—Ç–∞**: –ö–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –≤ –º–∞—à–∏–Ω–Ω—ã–π –∫–æ–¥
- **–ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º**: –í—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–æ—Ä—É—Ç–∏–Ω –∏ –∫–∞–Ω–∞–ª–æ–≤
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –°–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞ –∏ —Å—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- **–ö—Ä–æ—Å—Å–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å**: –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Windows, macOS, Linux

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Go

### 1. –ó–∞–≥—Ä—É–∑–∏—Ç–µ Go
–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [–æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π —Å–∞–π—Ç Go](https://golang.org/dl/) –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –¥–ª—è –≤–∞—à–µ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Go
–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–π —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫ –∏ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º.

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É
–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

\`\`\`bash
go version
\`\`\`

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ: \`go version go1.21.0 darwin/amd64\`

## –í–∞—à–∞ –ø–µ—Ä–≤–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª \`hello.go\`:

\`\`\`go
package main

import "fmt"

func main() {
    fmt.Println("–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!")
}
\`\`\`

### –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∫–æ–¥–∞:

- \`package main\`: –û–±—ä—è–≤–ª—è–µ—Ç, —á—Ç–æ —ç—Ç–æ –∏—Å–ø–æ–ª–Ω—è–µ–º–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞
- \`import "fmt"\`: –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –ø–∞–∫–µ—Ç –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
- \`func main()\`: –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º—É
- \`fmt.Println()\`: –í—ã–≤–æ–¥–∏—Ç —Ç–µ–∫—Å—Ç –≤ –∫–æ–Ω—Å–æ–ª—å

### –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã

\`\`\`bash
go run hello.go
\`\`\`

–†–µ–∑—É–ª—å—Ç–∞—Ç: \`–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!\`

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ Go –ø—Ä–æ–≥—Ä–∞–º–º—ã

1. **Package declaration**: –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–∞–∫–µ—Ç–∞
2. **Imports**: –ò–º–ø–æ—Ä—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
3. **Functions**: –§—É–Ω–∫—Ü–∏–∏, –≤–∫–ª—é—á–∞—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é \`main()\`

## –ß—Ç–æ –¥–∞–ª—å—à–µ?

–¢–µ–ø–µ—Ä—å –≤—ã –≥–æ—Ç–æ–≤—ã –∏–∑—É—á–∞—Ç—å:
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
- –£–ø—Ä–∞–≤–ª—è—é—â–∏–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
- –§—É–Ω–∫—Ü–∏–∏ –∏ –º–µ—Ç–æ–¥—ã

–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º —Å –ø–µ—Ä–≤—ã–º —à–∞–≥–æ–º –≤ –∏–∑—É—á–µ–Ω–∏–∏ Go!
    `,
  },
  {
    slug: "variables-and-types",
    title: "–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö",
    description:
      "–ò–∑—É—á–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É —Ç–∏–ø–æ–≤ Go, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ –±–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö.",
    level: "–ù–∞—á–∏–Ω–∞—é—â–∏–π",
    duration: "45 –º–∏–Ω",
    category: "basics",
    order: 2,
    is_free: true,
    content: `
# –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö –≤ Go

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –≤—ã –∏–∑—É—á–∏—Ç–µ —Å–∏—Å—Ç–µ–º—É —Ç–∏–ø–æ–≤ Go, —Å–ø–æ—Å–æ–±—ã –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ —Ä–∞–±–æ—Ç—É —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö.

## –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### –ü–æ–ª–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
\`\`\`go
var name string = "–ò–≤–∞–Ω"
var age int = 25
\`\`\`

### –° –≤—ã–≤–æ–¥–æ–º —Ç–∏–ø–∞
\`\`\`go
var name = "–ò–≤–∞–Ω"  // Go –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–∏–ø string
var age = 25       // Go –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Ç–∏–ø int
\`\`\`

### –ö—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–π)
\`\`\`go
name := "–ò–≤–∞–Ω"
age := 25
\`\`\`

## –ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

### –ß–∏—Å–ª–æ–≤—ã–µ —Ç–∏–ø—ã
- \`int\`, \`int8\`, \`int16\`, \`int32\`, \`int64\`
- \`uint\`, \`uint8\`, \`uint16\`, \`uint32\`, \`uint64\`
- \`float32\`, \`float64\`
- \`complex64\`, \`complex128\`

### –°—Ç—Ä–æ–∫–∏ –∏ —Å–∏–º–≤–æ–ª—ã
- \`string\`: –°—Ç—Ä–æ–∫–∏ –≤ UTF-8
- \`rune\`: –°–∏–º–≤–æ–ª Unicode (alias –¥–ª—è int32)
- \`byte\`: –ë–∞–π—Ç (alias –¥–ª—è uint8)

### –õ–æ–≥–∏—á–µ—Å–∫–∏–π —Ç–∏–ø
- \`bool\`: true –∏–ª–∏ false

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

\`\`\`go
package main

import "fmt"

func main() {
    // –°—Ç—Ä–æ–∫–∏
    name := "–ê–Ω–Ω–∞"
    fmt.Printf("–ò–º—è: %s\\n", name)
    
    // –ß–∏—Å–ª–∞
    age := 30
    height := 1.75
    fmt.Printf("–í–æ–∑—Ä–∞—Å—Ç: %d, –†–æ—Å—Ç: %.2f\\n", age, height)
    
    // –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
    isStudent := true
    fmt.Printf("–°—Ç—É–¥–µ–Ω—Ç: %t\\n", isStudent)
}
\`\`\`

## –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã

\`\`\`go
const pi = 3.14159
const greeting = "–ü—Ä–∏–≤–µ—Ç"

// –ì—Ä—É–ø–ø–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç
const (
    monday = 1
    tuesday = 2
    wednesday = 3
)
\`\`\`

## –ù—É–ª–µ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è

Go –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω—É–ª–µ–≤—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏:
- \`0\` –¥–ª—è —á–∏—Å–ª–æ–≤—ã—Ö —Ç–∏–ø–æ–≤
- \`""\` –¥–ª—è —Å—Ç—Ä–æ–∫
- \`false\` –¥–ª—è bool
- \`nil\` –¥–ª—è —É–∫–∞–∑–∞—Ç–µ–ª–µ–π, —Å—Ä–µ–∑–æ–≤, –∫–∞—Ä—Ç, –∫–∞–Ω–∞–ª–æ–≤, —Ñ—É–Ω–∫—Ü–∏–π –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö!
    `,
  },
];

export async function seedDatabase() {
  console.log("üå± Starting database seeding...");

  try {
    // Step 1: Ensure all tables exist
    await runMigrations();

    // Step 2: Create admin user
    console.log("üë§ Creating admin user...");
    try {
      const adminPassword = await bcrypt.hash("admin123", 10);
      await createUser({
        email: "admin@webschool.com",
        password_hash: adminPassword,
        name: "Admin",
        role: "admin",
        is_premium: true,
        premium_until: null,
      });
      console.log("‚úÖ Admin user created: admin@webschool.com / admin123");
    } catch (error) {
      const err = error as { code?: string; message?: string };
      if (err?.code === "23505" || err?.message?.includes("duplicate")) {
        console.log("‚ÑπÔ∏è  Admin user already exists - skipping");
      } else {
        throw error;
      }
    }

    // Step 3: Seed tutorials
    console.log("üìö Seeding tutorials...");
    for (const tutorial of tutorialsData) {
      try {
        await createTutorial(tutorial);
        console.log(`‚úÖ Created tutorial: ${tutorial.title}`);
      } catch (error) {
        // Skip if tutorial already exists (duplicate slug)
        const err = error as { code?: string; message?: string };
        if (err?.code === "23505" || err?.message?.includes("duplicate")) {
          console.log(
            `‚ÑπÔ∏è  Tutorial already exists: ${tutorial.title} - skipping`
          );
        } else {
          throw error;
        }
      }
    }

    // Step 4: Seed examples
    console.log("üíª Seeding examples...");
    const examplesData = [
      {
        slug: "hello-world",
        title: "–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä",
        description: "–ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ Hello World –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã —Å Go.",
        code: `package main

import "fmt"

func main() {
    fmt.Println("–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!")
}`,
        language: "go",
        category: "–û—Å–Ω–æ–≤—ã",
        order: 1,
      },
      {
        slug: "variables",
        title: "–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã",
        description: "–†–∞–±–æ—Ç–∞ —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç –≤ Go.",
        code: `package main

import "fmt"

func main() {
    // –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
    var name string = "Golang"
    age := 13  // –ö–æ—Ä–æ—Ç–∫–∞—è —Ñ–æ—Ä–º–∞
    
    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã
    const pi = 3.14159
    
    fmt.Printf("–Ø–∑—ã–∫: %s, –í–æ–∑—Ä–∞—Å—Ç: %d –ª–µ—Ç\\n", name, age)
    fmt.Printf("Pi = %.2f\\n", pi)
}`,
        language: "go",
        category: "–û—Å–Ω–æ–≤—ã",
        order: 2,
      },
    ];

    for (const example of examplesData) {
      try {
        await createExample(example);
        console.log(`‚úÖ Created example: ${example.title}`);
      } catch (error) {
        const err = error as { code?: string; message?: string };
        if (err?.code === "23505" || err?.message?.includes("duplicate")) {
          console.log(
            `‚ÑπÔ∏è  Example already exists: ${example.title} - skipping`
          );
        } else {
          throw error;
        }
      }
    }

    console.log("üéâ Database seeding complete!");
  } catch (error) {
    console.error("‚ùå Database seeding failed:", error);
    throw error;
  }
}
